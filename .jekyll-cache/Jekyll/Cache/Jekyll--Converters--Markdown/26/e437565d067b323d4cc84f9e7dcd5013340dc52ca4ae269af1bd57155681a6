I"î<h1 id="feignì„-í†µí•´-springquerymap-ì‚¬ìš©">feignì„ í†µí•´ @SpringQueryMap ì‚¬ìš©</h1>

<p><img src="/assets/images/msa/feign.png" alt="Untitled" /></p>

<h3 id="ìš”êµ¬ì‚¬í•­">::ìš”êµ¬ì‚¬í•­</h3>

<p>ê³ ê°ì˜ ê³¼ê±° ìƒë‹´ ì´ë ¥ì„ ì¡°íšŒí•´ì„œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•˜ëŠ” ë¡œì§</p>

<h3 id="-history-api"><strong>:: History API</strong></h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"histories"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HistoryQueryResource</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">HistoryQueryService</span> <span class="n">historyQueryService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span>
    <span class="kd">public</span> <span class="nc">HistoryList</span> <span class="nf">findAll</span><span class="o">(</span>
        <span class="nd">@SpringQueryMap</span> <span class="nc">HistoryQuery</span> <span class="n">historyQuery</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">historyQueryService</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">historyQuery</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="thirdparty">::Thirdparty</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@FeignClient</span><span class="o">(</span>
    <span class="n">contextId</span> <span class="o">=</span> <span class="s">"HistoryQueryClient"</span><span class="o">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"api"</span><span class="o">,</span>
    <span class="n">configuration</span> <span class="o">=</span> <span class="o">{</span><span class="nc">FeignConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">FeignLoggerLevelConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">},</span>
    <span class="n">primary</span> <span class="o">=</span> <span class="kc">false</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HistoryQueryClient</span><span class="o">{</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"histories"</span><span class="o">)</span>
    <span class="nc">HistoryList</span> <span class="nf">findAll</span><span class="o">(</span><span class="nd">@SpringQueryMap</span> <span class="nc">HistoryQuery</span> <span class="n">historyQuery</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="-ë¬¸ì œ">:: ë¬¸ì œ</h3>

<ul>
  <li>ì»¨íŠ¸ë¡¤ëŸ¬ê°€ MappingíŒŒë¼ë¯¸í„°ë¡œ ì„ ì–¸í•œ HistoryQueryì— ArrayList, Mapíƒ€ì…ì´ ì•„ë‹ˆë©´ ë§µí•‘ì´ ë˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ë°œìƒ</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HistoryQuery</span> <span class="kd">implements</span> <span class="nc">JsonSerializable</span> <span class="o">{</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>   <span class="c1">// --&gt; APIì„œë²„ë¡œ ë§µí•‘ë˜ì§€ ì•ŠìŒ</span>

    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>    <span class="c1">// --&gt; APIì„œë²„ë¡œ ë§µí•‘ë˜ì§€ ì•ŠìŒ</span>

    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="nc">IdList</span> <span class="n">channelIds</span> <span class="o">=</span> <span class="nc">IdList</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span> <span class="c1">// --&gt; ë§µí•‘ok</span>

    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="nc">IdList</span> <span class="n">status</span> <span class="o">=</span> <span class="nc">IdList</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>  <span class="c1">// --&gt; ë§µí•‘ok</span>

    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">customerId</span> <span class="o">=</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">EMPTY</span><span class="o">;</span>  <span class="c1">// --&gt; APIì„œë²„ë¡œ ë§µí•‘ë˜ì§€ ì•ŠìŒ</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="-ë¬¸ì œ-1">:: ë¬¸ì œ</h3>

<ol>
  <li>
    <p>í˜¸ì¶œ URLì—ëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ, History API ì„œë²„ì—ëŠ” offset, limit, customerIdê°€ ì°íˆì§€ ì•ŠìŒ</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> -&gt; GET http://api/histories?offset=0&amp;status=closed&amp;limit=1
 &amp;customerId=tester&amp;channelIds=kakao
</code></pre></div>    </div>
  </li>
  <li>
    <p>feign doc</p>
  </li>
</ol>

<p><a href="https://cloud.spring.io/spring-cloud-openfeign/reference/html/#feign-querymap-support">Spring Cloud OpenFeign</a></p>

<p>docì„ ë³´ë©´, POJO, Map ëª¨ë‘ ì§€ì›í•œë‹¤ê³  ë˜ì–´ìˆì§€ë§Œ, í…ŒìŠ¤íŠ¸í•´ë³´ë‹ˆ ë¦¬ìŠ¤íŠ¸ë‚˜ ë§µì´ ì•„ë‹ˆë©´ ì•ˆë¨</p>

<h3 id="-ë¬¸ì œí•´ê²°">:: ë¬¸ì œí•´ê²°</h3>

<ol>
  <li>Param.Expanderë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• â€”&gt; ë°›ëŠ” ìª½ì´ array, mapì´ ì•„ë‹ˆë©´ ì´ê²ƒë„ ì•ˆë¨</li>
</ol>

<table>
  <tbody>
    <tr>
      <td>[Feign Client does not resolve Query parameter</td>
      <td>Newbedev](https://newbedev.com/feign-client-does-not-resolve-query-parameter)</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>API ìŠ¤í™ì„ ë³€ê²½í•˜ëŠ” ë°©ë²•â€¦.</li>
</ol>
:ET