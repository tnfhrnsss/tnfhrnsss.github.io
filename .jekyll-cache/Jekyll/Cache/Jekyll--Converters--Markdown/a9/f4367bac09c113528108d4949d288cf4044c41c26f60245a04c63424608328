I"Ì3<aside>
ğŸ’¡ ì§€ê¸ˆê¹Œì§€ ì°¾ì•„ë³¸ ë°©ì‹ ì¤‘ 2ê°€ì§€ë¥¼ ì •ë¦¬

</aside>

<p>[ê³µí†µ]</p>

<p>ê¸°ì¡´ ë°ì´í„° ë°±ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤.</p>

<p>ìŠ¤ëƒ…ìƒ· ë°±ì—… ë°©ì‹ì€ <a href="elasticsearch%20%E1%84%89%E1%85%B3%E1%84%82%E1%85%A2%E1%86%B8%E1%84%89%E1%85%A3%E1%86%BA%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%87%E1%85%A9%E1%86%A8%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20ab7073fe4fe247b19f91220552094a42.md">â€œì—¬ê¸°â€</a> ì°¸ê³ í•˜ì„¸ìš”.</p>

<h1 id="ê¸°ì¡´-ë°ì´í„°ì—-ì¶”ê°€í•˜ëŠ”-ë°©ì‹">[ê¸°ì¡´ ë°ì´í„°ì— ì¶”ê°€í•˜ëŠ” ë°©ì‹]</h1>

<aside>
ğŸ’¡ *ë°ì´í„°ê°€ ì ê³ , ì„œë²„ì— ë¬¸ì œê°€ ì—†ì„ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.  (ë¡œì»¬ì˜ ê²½ìš°ì—ë§Œ ì§„í–‰í•˜ë„ë¡ í•©ë‹ˆë‹¤.)*

</aside>

<h3 id="1-í˜„ì¬-ì ìš©ëœ-ë§µí•‘-ì •ë³´ë¥¼-ì¡°íšŒí•œë‹¤">1. í˜„ì¬ ì ìš©ëœ ë§µí•‘ ì •ë³´ë¥¼ ì¡°íšŒí•œë‹¤.</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket/_mapping</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-ìœ„ì—ì„œ-ì¡°íšŒí•œ-ë§µí•‘-ì •ë³´ë¥¼-ì°¸ê³ í•´ì„œ-depthì—-ë§ê²Œ-ì»¬ëŸ¼ì„-ì¶”ê°€í•œë‹¤">2. ìœ„ì—ì„œ ì¡°íšŒí•œ ë§µí•‘ ì •ë³´ë¥¼ ì°¸ê³ í•´ì„œ, depthì— ë§ê²Œ ì»¬ëŸ¼ì„ ì¶”ê°€í•œë‹¤.</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">attic_ticket/_mappings</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"customer"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"nested"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"messengerId"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">customerì—</span><span class="w"> </span><span class="err">messengerId</span><span class="w"> </span><span class="err">ì»¬ëŸ¼</span><span class="w"> </span><span class="err">ì¶”ê°€</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><img src="../img/els2-1.png" alt="../img/els2-1.png" /></p>

<h3 id="3-ì˜-ì¶”ê°€ë˜ì—ˆëŠ”ì§€-í™•ì¸í•œë‹¤">3. ì˜ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket/_mapping</span><span class="w">
</span></code></pre></div></div>

<h3 id="4-ê¸°ì¡´-ë°ì´í„°ì—-ì¶”ê°€í•œ-í•„ë“œë¥¼-ì—…ë°ì´íŠ¸-í•œë‹¤-multiple-update-">4. ê¸°ì¡´ ë°ì´í„°ì— ì¶”ê°€í•œ í•„ë“œë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.( multiple update )</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">attic_ticket/_update_by_query</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctx._source.customer.messengerId = ''"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="-í•„ë“œê°€-ë°°ì—´ì¸-ê²½ìš°-">** (í•„ë“œê°€ ë°°ì—´ì¸ ê²½ìš°) **</h1>

<h3 id="5-1-ê¸°ì¡´-ë°°ì—´-ì‚­ì œ">5-1. ê¸°ì¡´ ë°°ì—´ ì‚­ì œ</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">attic_message/_update_by_query</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctx._source.remove('metaarray')"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"channelUrl"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"92095428-d647-466c-a054-e1e984dd48b1"</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="5-2-ë°°ì—´-ì´ˆê¸°í™”">5-2. ë°°ì—´ ì´ˆê¸°í™”</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">attic_message/_update_by_query</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctx._source.metaarray = []"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"channelUrl"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"92095428-d647-466c-a054-e1e984dd48b1"</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="5-3-ë°°ì—´ì—-ê°’-ì¶”ê°€">5-3. ë°°ì—´ì— ê°’ ì¶”ê°€</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">attic_message/_update_by_query</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"source"</span><span class="p">:</span><span class="s2">"ctx._source.metaarray.add(params)"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"templateMessage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"value"</span><span class="p">:[</span><span class="w">
                </span><span class="s2">"{~~~~~~~~~~}"</span><span class="w">
              </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"channelUrl"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"92095428-d647-466c-a054-e1e984dd48b1"</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="5--ê²€ì¦">5.  ê²€ì¦</h3>

<ol>
  <li>ì¼ë¶€ í‹°ì¼“ì—ë§Œ ì¶”ê°€í•œ í•„ë“œì— ê°’ì„ ì—…ë°ì´íŠ¸í•´ë³¸ë‹¤.</li>
</ol>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">attic_ticket/_update_by_query</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"source"</span><span class="p">:</span><span class="s2">"ctx._source.customer.messengerId = 'honggildong'"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:{</span><span class="w">     </span><span class="err">//</span><span class="w"> </span><span class="err">ì¼ë¶€</span><span class="w"> </span><span class="err">ticketì—ë§Œ</span><span class="w"> </span><span class="err">ê°’ì„</span><span class="w"> </span><span class="err">ì—…ë°ì´íŠ¸í•˜ê³ </span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"ticketId"</span><span class="p">:</span><span class="s2">"63af9a77-845b-4ca5-b692-0d3e5cc7d398"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ol>
  <li>ì¶”ê°€í•œ ê°’ìœ¼ë¡œ ê²€ìƒ‰í•´ë³¸ë‹¤.</li>
</ol>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket/_search</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"should"</span><span class="p">:[{</span><span class="w">
          </span><span class="nl">"terms"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"ticketId"</span><span class="p">:[</span><span class="s2">"63af9a77-845b-4ca5-b692-0d3e5cc7d398"</span><span class="p">],</span><span class="nl">"boost"</span><span class="p">:</span><span class="mf">1.0</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>ì°¸ê³ ) <a href="https://esbook.kimjmin.net/04-data/4.3-_bulk">https://esbook.kimjmin.net/04-data/4.3-_bulk</a></p>
:ET