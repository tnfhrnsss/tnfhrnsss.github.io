<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>elasticsearch 필드 추가(2) | _JJ@Developer</title><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="elasticsearch 필드 추가(2)" /><meta property="og:locale" content="en_US" /><meta name="description" content="A Jekyll theme for documentation" /><meta property="og:description" content="A Jekyll theme for documentation" /><link rel="canonical" href="http://localhost:4000/docs/msa/elastic-search/elasticsearch_add_field_2/" /><meta property="og:url" content="http://localhost:4000/docs/msa/elastic-search/elasticsearch_add_field_2/" /><meta property="og:site_name" content="_JJ@Developer" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="elasticsearch 필드 추가(2)" /> <script type="application/ld+json"> {"url":"http://localhost:4000/docs/msa/elastic-search/elasticsearch_add_field_2/","headline":"elasticsearch 필드 추가(2)","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/one_.png"}},"description":"A Jekyll theme for documentation","@type":"WebPage","@context":"https://schema.org"}</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1261619070611227" crossorigin="anonymous"></script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/msa" class="nav-list-link">Msa</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/msa/feign/feign/" class="nav-list-link">Feign</a><ul class="nav-list"></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/msa/elastic-search/elasticsearch/" class="nav-list-link">Elastic Search</a><ul class="nav-list"></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/patterns" class="nav-list-link">Patterns</a><ul class="nav-list "></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/errors" class="nav-list-link">Errors</a><ul class="nav-list "></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/clipping" class="nav-list-link">Clipping</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/clipping/jpa/jpa/" class="nav-list-link">Jpa</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/docs/clipping/jpa/jpa%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/" class="nav-list-link">jpa 프로그래밍</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/mooc" class="nav-list-link">Mooc</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/mooc/udacity/udacity/" class="nav-list-link">Udacity</a><ul class="nav-list"></ul><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/mooc/udemy/udemy/" class="nav-list-link">Udemy</a><ul class="nav-list"></ul></ul><li class="nav-list-item"><a href="http://localhost:4000/docs/bookmark/" class="nav-list-link">★bookmark</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search _JJ@Developer" aria-label="Search _JJ@Developer" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/msa">Msa</a><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/msa/elastic-search/elasticsearch/">Elastic Search</a><li class="breadcrumb-nav-list-item"><span>elasticsearch 필드 추가(2)</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="elasticsearch-필드-추가2"> <a href="#elasticsearch-필드-추가2" class="anchor-heading" aria-labelledby="elasticsearch-필드-추가2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> elasticsearch 필드 추가(2)</h1><p>[공통]</p><p>기존 데이터 백업을 진행합니다.</p><p>스냅샷 백업 방식은 <a href="elasticsearch%20%E1%84%89%E1%85%B3%E1%84%82%E1%85%A2%E1%86%B8%E1%84%89%E1%85%A3%E1%86%BA%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%87%E1%85%A9%E1%86%A8%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20ab7073fe4fe247b19f91220552094a42.md">“여기”</a> 참고하세요.</p><h1 id="alias를-활용하는-방식"> <a href="#alias를-활용하는-방식" class="anchor-heading" aria-labelledby="alias를-활용하는-방식"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> [Alias를 활용하는 방식]</h1><aside> 💡 무중단 방식인 만큼, 데이터가 많은 경우 size를 나눠서 진행하고, 백업은 필수로 합니다.</aside><h2 id="1-현재-적용된-맵핑-정보를-조회한다"> <a href="#1-현재-적용된-맵핑-정보를-조회한다" class="anchor-heading" aria-labelledby="1-현재-적용된-맵핑-정보를-조회한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. 현재 적용된 맵핑 정보를 조회한다.</h2><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket/_mapping</span><span class="w">
</span></code></pre></div></div><h2 id="2-위에서-조회한-맵핑-정보를-복사해서-새로운-필드을-추가하고-새로운-맵핑정보를-가진-인덱스를-생성한다"> <a href="#2-위에서-조회한-맵핑-정보를-복사해서-새로운-필드을-추가하고-새로운-맵핑정보를-가진-인덱스를-생성한다" class="anchor-heading" aria-labelledby="2-위에서-조회한-맵핑-정보를-복사해서-새로운-필드을-추가하고-새로운-맵핑정보를-가진-인덱스를-생성한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. 위에서 조회한 맵핑 정보를 복사해서, 새로운 필드을 추가하고 새로운 맵핑정보를 가진 인덱스를 생성한다.</h2><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">attic_ticket_new</span><span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">attic_ticket_new</span><span class="w"> </span><span class="err">인덱스를</span><span class="w"> </span><span class="err">생성</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"mappings"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"properties"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"keyword"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"keyword"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"ignore_above"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
				</span><span class="nl">"customer"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"nested"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"properties"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"messengerId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">messengerId</span><span class="w"> </span><span class="err">필드</span><span class="w"> </span><span class="err">추가</span><span class="w">
              </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"keyword"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"keyword"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ignore_above"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
</span><span class="err">......(중략).......</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p><img src="../img/els3-0.png" alt="../img/els3-0.png" /></p><h2 id="3-잘-추가되었는지-확인한다"> <a href="#3-잘-추가되었는지-확인한다" class="anchor-heading" aria-labelledby="3-잘-추가되었는지-확인한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. 잘 추가되었는지 확인한다</h2><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket_new/_mapping</span><span class="w">
</span></code></pre></div></div><h2 id="4-새로-생성한-인덱스로-기존-데이터-복사"> <a href="#4-새로-생성한-인덱스로-기존-데이터-복사" class="anchor-heading" aria-labelledby="4-새로-생성한-인덱스로-기존-데이터-복사"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. 새로 생성한 인덱스로 기존 데이터 복사</h2><aside> 💡 document양이 10만이 넘어가면 Kibana로 했을때 504 Gateway timeout발생하게 되므로 비동기로 실행되도록 옵션 wait_for_completion=false를 준다.</aside><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">_reindex?wait_for_completion=</span><span class="kc">false</span><span class="w">   </span><span class="err">//</span><span class="w"> </span><span class="kc">false</span><span class="err">로</span><span class="w"> </span><span class="err">하면</span><span class="w"> </span><span class="err">비동기로</span><span class="w"> </span><span class="err">실행하겠다는</span><span class="w"> </span><span class="err">뜻</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket"</span><span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">원본</span><span class="w"> </span><span class="err">인덱스</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket_new"</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">필드</span><span class="w"> </span><span class="err">추가해서</span><span class="w"> </span><span class="err">새로</span><span class="w"> </span><span class="err">생성한</span><span class="w"> </span><span class="err">인덱스</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p><img src="../img/els3-1.png" alt="../img/els3-1.png" /></p><ul><li>_reindex api는 _source가 enable일때만 가능하다(_search하면 enable인지 확인가능)<li>_reindex는 mapping정보는 복사하지 않고 데이터만 복사하기 때문에 새로운 index쪽에 따로 mapping정보를 맞춰줘야 하는 것.</ul><h3 id="4-1-데이터-양이-많은-경우-여러번-나눠서-수행한다"> <a href="#4-1-데이터-양이-많은-경우-여러번-나눠서-수행한다" class="anchor-heading" aria-labelledby="4-1-데이터-양이-많은-경우-여러번-나눠서-수행한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4-1. 데이터 양이 많은 경우, 여러번 나눠서 수행한다.</h3><aside> 💡 reindex는 scroll batch이기 때문에, 사이즈를 나눠서 수행한다. (default size는 1000)</aside><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">_reindex?wait_for_completion=</span><span class="kc">false</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket"</span><span class="w">
    </span><span class="nl">"size"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">999</span><span class="w">   </span><span class="err">//</span><span class="w"> </span><span class="err">나눠서</span><span class="w"> </span><span class="err">수행할</span><span class="w"> </span><span class="err">크기를</span><span class="w"> </span><span class="err">지정한다.</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket_new"</span><span class="w"> 
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><h3 id="4-2-원본이-원격지에-있는-경우-원본-데이터-중-일부만-대상으로-하는-경우"> <a href="#4-2-원본이-원격지에-있는-경우-원본-데이터-중-일부만-대상으로-하는-경우" class="anchor-heading" aria-labelledby="4-2-원본이-원격지에-있는-경우-원본-데이터-중-일부만-대상으로-하는-경우"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4-2. 원본이 원격지에 있는 경우, 원본 데이터 중 일부만 대상으로 하는 경우</h3><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">_reindex?wait_for_completion=</span><span class="kc">false</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"remote"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">     </span><span class="err">//</span><span class="w"> </span><span class="err">원본데이터가</span><span class="w"> </span><span class="err">있는</span><span class="w"> </span><span class="err">원격지</span><span class="w"> </span><span class="err">정보</span><span class="w">
			</span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://remotehost:9200"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pass"</span><span class="w">
		</span><span class="p">},</span><span class="w">
    </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket"</span><span class="p">,</span><span class="w">   </span><span class="err">//</span><span class="w"> </span><span class="err">원본</span><span class="w"> </span><span class="err">인덱스</span><span class="w">
    </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">     </span><span class="err">//</span><span class="w"> </span><span class="err">일부</span><span class="w"> </span><span class="err">데이터만</span><span class="w"> </span><span class="err">복사할</span><span class="w"> </span><span class="err">경우</span><span class="w"> </span><span class="err">조건</span><span class="w"> </span><span class="err">쿼리를</span><span class="w"> </span><span class="err">추가한다.</span><span class="w">
       </span><span class="nl">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"field_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"field_value"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket_new"</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">필드</span><span class="w"> </span><span class="err">추가해서</span><span class="w"> </span><span class="err">새로</span><span class="w"> </span><span class="err">생성한</span><span class="w"> </span><span class="err">인덱스</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><h3 id="4-3-비동기-수행-후-수행-결과-조회"> <a href="#4-3-비동기-수행-후-수행-결과-조회" class="anchor-heading" aria-labelledby="4-3-비동기-수행-후-수행-결과-조회"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4-3. 비동기 수행 후, 수행 결과 조회</h3><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">_tasks</span><span class="w">
</span></code></pre></div></div><p><img src="../img/els3-2.png" alt="../img/els3-2.png" /></p><ul><li>task번호로 조회한다.<li>cancellable이 true이면, 수행 중 취소가 가능하다.</ul><h2 id="5--원본데이터와-복사데이터-count를-비교해본다"> <a href="#5--원본데이터와-복사데이터-count를-비교해본다" class="anchor-heading" aria-labelledby="5--원본데이터와-복사데이터-count를-비교해본다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. 원본데이터와 복사데이터 count를 비교해본다.</h2><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket/_count</span><span class="w">

</span><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket_new/_count</span><span class="w">
</span></code></pre></div></div><p><img src="../img/els3-3.png" alt="../img/els3-3.png" /></p><h2 id="6-새로-추가한-인덱스에-기존-인덱스의-alias로-교체해야한다"> <a href="#6-새로-추가한-인덱스에-기존-인덱스의-alias로-교체해야한다" class="anchor-heading" aria-labelledby="6-새로-추가한-인덱스에-기존-인덱스의-alias로-교체해야한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. 새로 추가한 인덱스에 기존 인덱스의 alias로 교체해야한다.</h2><h3 id="6-1-attic_ticket에-alias를-추가한다-삭제되게-되지만-alias를-교체해야하므로-원본에-alias가-있어야한다"> <a href="#6-1-attic_ticket에-alias를-추가한다-삭제되게-되지만-alias를-교체해야하므로-원본에-alias가-있어야한다" class="anchor-heading" aria-labelledby="6-1-attic_ticket에-alias를-추가한다-삭제되게-되지만-alias를-교체해야하므로-원본에-alias가-있어야한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6-1. attic_ticket에 alias를 추가한다. (삭제되게 되지만, alias를 교체해야하므로 원본에 alias가 있어야한다.)</h3><aside> 💡 alias 이름은 index이름과 동일한 이름으로 지정할 수 없습니다. alias 이름으로도 인덱스 검색이 되어야하므로...</aside><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">/_aliases</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"actions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"add"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"index"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket"</span><span class="p">,</span><span class="w"> </span><span class="nl">"alias"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket_alias"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><h3 id="6-2-새로-추가한-인덱스에-기존-원본-alias로-교체해준다-alias-add를-먼저-실행하면-동일한-alias를-가진-색인이-2개가-되므로-거의-동일한-검색결과가-2건씩-나오게-된다-반대로-기존-alias를-먼저-지우면-클라이언트에서-검색-요청이-들어왔을-때-해당-alias내지-인덱스가-없으므로-오류가-발생하기-때문에-add와-remove를-동시에-진행"> <a href="#6-2-새로-추가한-인덱스에-기존-원본-alias로-교체해준다-alias-add를-먼저-실행하면-동일한-alias를-가진-색인이-2개가-되므로-거의-동일한-검색결과가-2건씩-나오게-된다-반대로-기존-alias를-먼저-지우면-클라이언트에서-검색-요청이-들어왔을-때-해당-alias내지-인덱스가-없으므로-오류가-발생하기-때문에-add와-remove를-동시에-진행" class="anchor-heading" aria-labelledby="6-2-새로-추가한-인덱스에-기존-원본-alias로-교체해준다-alias-add를-먼저-실행하면-동일한-alias를-가진-색인이-2개가-되므로-거의-동일한-검색결과가-2건씩-나오게-된다-반대로-기존-alias를-먼저-지우면-클라이언트에서-검색-요청이-들어왔을-때-해당-alias내지-인덱스가-없으므로-오류가-발생하기-때문에-add와-remove를-동시에-진행"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6-2. 새로 추가한 인덱스에 기존 원본 alias로 교체해준다. (alias add를 먼저 실행하면 동일한 alias를 가진 색인이 2개가 되므로 (거의) 동일한 검색결과가 2건씩 나오게 된다. 반대로 기존 alias를 먼저 지우면 클라이언트에서 검색 요청이 들어왔을 때 해당 alias내지 인덱스가 없으므로 오류가 발생하기 때문에 add와 remove를 동시에 진행)</h3><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">/_aliases</span><span class="w">
</span><span class="p">{</span><span class="w">
		</span><span class="nl">"actions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"add"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket_new"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"remove"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"index"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"alias"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"attic_ticket_alias"</span><span class="w">
            </span><span class="p">}</span><span class="w">
       </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><h3 id="6-3-새로운-인덱스에-alias가-잘-맵핑되어있는지-확인한다"> <a href="#6-3-새로운-인덱스에-alias가-잘-맵핑되어있는지-확인한다" class="anchor-heading" aria-labelledby="6-3-새로운-인덱스에-alias가-잘-맵핑되어있는지-확인한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6-3. 새로운 인덱스에 alias가 잘 맵핑되어있는지 확인한다.</h3><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">/_alias</span><span class="w">
</span></code></pre></div></div><p><img src="../img/els3-4.png" alt="../img/els3-4.png" /></p><h2 id="7-검증"> <a href="#7-검증" class="anchor-heading" aria-labelledby="7-검증"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. 검증</h2><h3 id="7-1-새로운-티켓을-인입-또는-종료시켜본다"> <a href="#7-1-새로운-티켓을-인입-또는-종료시켜본다" class="anchor-heading" aria-labelledby="7-1-새로운-티켓을-인입-또는-종료시켜본다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7-1. 새로운 티켓을 인입 또는 종료시켜본다.</h3><p>7-2. 새로운 인덱스로 검색해본다.</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">attic_ticket/_search</span><span class="w">     </span><span class="err">//</span><span class="w"> </span><span class="err">교체한</span><span class="w"> </span><span class="err">alias명으로</span><span class="w"> </span><span class="err">검색</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"should"</span><span class="p">:[{</span><span class="w">
          </span><span class="nl">"terms"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"ticketId"</span><span class="p">:[</span><span class="s2">"f6872447-be1a-4152-8325-7620a6ee084f"</span><span class="p">],</span><span class="nl">"boost"</span><span class="p">:</span><span class="mf">1.0</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p><img src="../img/els3-5.png" alt="../img/els3-5.png" /></p><ul><li>검색 결과의 _index가 새로 생성한 인덱스명인지 확인</ul><h2 id="참고"> <a href="#참고" class="anchor-heading" aria-labelledby="참고"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 참고</h2><p><a href="https://www.elastic.co/kr/blog/changing-mapping-with-zero-downtime">https://www.elastic.co/kr/blog/changing-mapping-with-zero-downtime</a></p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2020 Patrick Marsceill. Distributed by an <a href="https://github.com/pmarsceill/just-the-docs/tree/master/LICENSE.txt">MIT license.</a></p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div>
